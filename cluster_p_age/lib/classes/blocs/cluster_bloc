import 'dart:async';
import 'cluster_repository.dart';
import 'cluster_node_response.dart';
import 'api_response.dart';


class ClusterBloc {
  ClusterRepository _clusterRepository;
StreamController _clusterListController;
StreamSink<ApiResponse<List<Cluster>>> get clusterListSink =>
      _clusterListController.sink;
Stream<ApiResponse<List<Cluster>>> get clusterListStream =>
      _clusterListController.stream;
ClusterBloc() {
    _clusterListController = StreamController<ApiResponse<List<Cluster>>>();
    _clusterRepository = clusterRepository();
    fetchClusterList();
  }
fetchClusterList() async {
    clusterListSink.add(ApiResponse.loading('Fetching Clusters'));
    try {
      List<Cluster> clusters = await _clusterRepository.fetchClusterList();
      clusterListSink.add(ApiResponse.completed(clusters));
    } catch (e) {
      clusterListSink.add(ApiResponse.error(e.toString()));
      print(e);
    }
  }
dispose() {
    _clusterListController?.close();
  }
}